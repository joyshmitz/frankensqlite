{
  "id": "021_transaction_edge_cases",
  "description": "Transaction edge semantics: savepoint rollback and nested BEGIN error path",
  "ops": [
    { "op": "open", "path": ":memory:" },
    { "op": "exec", "sql": "CREATE TABLE q5(id INTEGER PRIMARY KEY, note TEXT)" },
    { "op": "exec", "sql": "BEGIN" },
    { "op": "exec", "sql": "INSERT INTO q5 VALUES(1, 'outer')" },
    { "op": "exec", "sql": "SAVEPOINT s1" },
    { "op": "exec", "sql": "INSERT INTO q5 VALUES(2, 'inner')" },
    { "op": "exec", "sql": "ROLLBACK TO s1" },
    { "op": "exec", "sql": "RELEASE s1" },
    { "op": "exec", "sql": "COMMIT" },
    {
      "op": "query",
      "sql": "SELECT id, note FROM q5 ORDER BY id",
      "expect": { "rows": [["1", "outer"]], "ordered": true }
    },
    { "op": "exec", "sql": "BEGIN" },
    { "op": "exec", "sql": "BEGIN", "expect_error": "ERROR" },
    { "op": "exec", "sql": "ROLLBACK" }
  ],
  "fsqlite_modes": ["compatibility", "native"]
}
